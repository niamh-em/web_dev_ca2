/* 
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/ClientSide/javascript.js to edit this template
 */

let json = {
    "goal": {
        "number": 12,
        "title": "Responsible Consumption and Production",
        "description": "Ensure sustainable consumption and production patterns.",
        "links": {
            "official": "https://sdgs.un.org/goals/goal12",
            "undp": "https://www.undp.org/sustainable-development-goals#responsible-consumption-and-production"
        },
        "targets": [
            {
                "id": 1,
                "number": "12.1",
                "description": "Implement the 10-Year Framework of Programmes on Sustainable Consumption and Production.",
                "examples": [
                    {
                        "title": "EU Circular Economy Action Plan",
                        "description": "Policies that support circular economy systems.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_1_01.png",
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_1_02.png"
                        ],
                        "tags": ["circular economy", "policy", "waste reduction", "EU"]
                    },
                    {
                        "title": "Japan’s 3R Initiative",
                        "description": "Japan promotes Reduce, Reuse, Recycle.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_1_03.png",
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_1_04.png"
                        ],
                        "tags": ["3R", "waste reduction", "Japan", "policy"]
                    }
                ]
            },
            {
                "id": 2,
                "number": "12.2",
                "description": "By 2030, achieve sustainable management and efficient use of natural resources.",
                "examples": [
                    {
                        "title": "Sustainable Forestry in Finland",
                        "description": "Finland manages forests sustainably.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_2_01.png"
                        ],
                        "tags": ["forestry", "natural resources", "sustainability", "Finland"]
                    },
                    {
                        "title": "Water Efficiency in Singapore",
                        "description": "Singapore’s advanced water recycling systems.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_2_02.png"
                        ],
                        "tags": ["water management", "technology", "Singapore", "resource efficiency"]
                    }
                ]
            },
            {
                "id": 3,
                "number": "12.3",
                "description": "Halve per capita global food waste.",
                "examples": [
                    {
                        "title": "Food Rescue Program",
                        "description": "Connecting restaurants with consumers to reduce food waste.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_3_01.png"
                        ],
                        "tags": ["food waste", "technology", "app"]
                    },
                    {
                        "title": "France’s Food Waste Law",
                        "description": "France bans supermarkets throwing food away.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_3_02.png"
                        ],
                        "tags": ["policy", "food waste", "France"]
                    }
                ]
            },
            {
                "id": 4,
                "number": "12.4",
                "description": "Environmentally sound management of chemicals and wastes.",
                "examples": [
                    {
                        "title": "Hazardous Waste Control",
                        "description": "Regulating hazardous waste movement.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_4_01.png"
                        ],
                        "tags": ["international treaty", "hazardous waste"]
                    },
                    {
                        "title": "Sweden’s Chemical Tax",
                        "description": "Tax on hazardous chemicals in electronics.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_4_02.png"
                        ],
                        "tags": ["chemicals", "tax policy", "Sweden"]
                    }
                ]
            },
            {
                "id": 5,
                "number": "12.5",
                "description": "Substantially reduce waste generation.",
                "examples": [
                    {
                        "title": "San Francisco Zero Waste Program",
                        "description": "Strict recycling & composting laws.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_5_01.png"
                        ],
                        "tags": ["zero waste", "recycling"]
                    },
                    {
                        "title": "Plastic Bag Ban in Kenya",
                        "description": "Kenya bans plastic bags.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_5_02.png"
                        ],
                        "tags": ["plastic ban", "Kenya"]
                    }
                ]
            },
            {
                "id": 6,
                "number": "12.6",
                "description": "Encourage companies to adopt sustainability reporting.",
                "examples": [
                    {
                        "title": "Corporate Sustainability Reporting",
                        "description": "Companies integrating sustainability into business.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_6_01.png"
                        ],
                        "tags": ["corporate sustainability"]
                    },
                    {
                        "title": "Outdoor Industry Transparency",
                        "description": "Environmental impact reporting in outdoor industry.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_6_02.png"
                        ],
                        "tags": ["corporate sustainability", "reporting"]
                    }
                ]
            },
            {
                "id": 7,
                "number": "12.7",
                "description": "Promote sustainable public procurement.",
                "examples": [
                    {
                        "title": "Green Public Procurement in Europe",
                        "description": "Government sustainability standards.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_7_01.png"
                        ],
                        "tags": ["green procurement", "EU"]
                    },
                    {
                        "title": "South Korea’s Green Purchasing Law",
                        "description": "Eco-friendly purchasing policies.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_7_02.png"
                        ],
                        "tags": ["procurement", "South Korea"]
                    }
                ]
            },
            {
                "id": 8,
                "number": "12.8",
                "description": "Ensure global awareness for sustainable development.",
                "examples": [
                    {
                        "title": "SDG Public Campaigns",
                        "description": "Education and awareness programs.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_8_01.png"
                        ],
                        "tags": ["awareness", "UN"]
                    },
                    {
                        "title": "Costa Rica Environmental Education",
                        "description": "Schools teach eco-friendly practices.",
                        "images": [
                            "https://derek.comp.dkit.ie/un/images/un_sustainable_development_goals_12_8_02.png"
                        ],
                        "tags": ["education", "Costa Rica"]
                    }
                ]
            }
        ]
    }
}

////////////////////////////////////////////////////////////////////////////////////

// getting the keys 
let keys = Object.keys(json.goal.targets[0]) // array of 4 

// initially set the sort to ascending order
let sortAscendingOrder = true

// initially set the last sorted column to be id
let lastSortColumnName = "id"

function displayTable() {
    // dynamically making the header
    let headerString = `<h1>Goal ${json.goal.number}: ${json.goal.title} </h1> <br>
                        <h3>${json.goal.description}</h3>
                        <p>Official Link: <a href="${json.goal.links.official}" target="blank">${json.goal.links.official}</a></p>
                        <p>UNDP Link: <a href="${json.goal.links.undp}" target="blank">${json.goal.links.undp}</a></p>`

    document.getElementById("header").innerHTML = headerString

    // arrow changes whether ascending is true or not 
    let arrow = sortAscendingOrder === true ? " ↑" : " ↓"

    let htmlString = `<table>
                        <thead>
                            <tr>`

    // getting the table headers from the keys 
    keys.forEach(key => {
        // we don't want to show examples in the table because if we do they are undefined at this point (plus we show them later in the modal)
        if (key !== "examples") {
            htmlString += `<th onclick=sort("${key}")>${key}${lastSortColumnName === key ? arrow : ""}</th>`
        }
    })

    htmlString += `</tr>
                        </thead><tbody>`

    // getting the content for the body of the table 
    json.goal.targets.forEach(target =>
    {
        htmlString += `<tr onclick="openModal(${target.id},${target.number},'${target.description}', 
                                            '${target.examples[0].title}', '${target.examples[0].description}', '${target.examples[0].images[0]}',
                                             '${target.examples[1].title}', '${target.examples[1].description}', '${target.examples[1].images[0]}')">`,
                keys.forEach(key => {
                    // we don't want to show examples in the table because if we do they are undefined at this point (plus we show them later in the modal)
                    if (key !== "examples") {
                        htmlString += `<td>${target[key]}</td>`
                    }
                }),
                htmlString += `</tr>`
    }
    )

    htmlString += `</tbody></table>`

    document.getElementById("table").innerHTML = htmlString

}

// initial code for modal taken from derek.comp: https://derek.comp.dkit.ie/
function openModal(id, number, description, example_title1, example_description1, example_image1, example_title2, example_description2, example_image2) {
    // the images are showing up for all except the 1st row 
    // but in the console.log the links for the images are showing up properly
    //console.log("image 1", example_image1)
    //console.log("image 2", example_image2)

    document.getElementById("modal").showModal()

    let htmlString = `<p>ID: ${id} <br> 
                    Number: ${number} <br>
                    Description: '${description}' <br>
                    Example: <br>
                    Title: '${example_title1}' <br>
                    Description: '${example_description1}' <br>
                    Image: <br> <img src = '${example_image1}'> <br>
                    Title: '${example_title2}' <br>
                    Description: '${example_description2}' <br>
                    Image: <br> <img src = '${example_image2}'></p>`


    document.getElementById("modal-content").innerHTML = htmlString
}

function closeModal() {
    document.getElementById('modal').close()
}

// intial sort code taken from derek.comp: https://derek.comp.dkit.ie/
function sort(key)
{ 
    if (lastSortColumnName === key){
        // if the last clicked coloumn is the same as the key, it sorts in the reverse
        sortAscendingOrder = !sortAscendingOrder
    } 
    else {
        lastSortColumnName = key
        sortAscendingOrder = true
    }

    if (sortAscendingOrder){
        json.goal.targets.sort((a, b) => a[key] < b[key] ? -1 : 1)
    } 
    else {
        json.goal.targets.sort((a, b) => a[key] < b[key] ? 1 : -1)
    }
    displayTable()
}
